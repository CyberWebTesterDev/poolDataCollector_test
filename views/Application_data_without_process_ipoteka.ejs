<!DOCTYPE HTML>
<html>
 <head>
  <meta charset="utf-8">
  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico">
  <link rel="stylesheet" href="/public/css/bootstrap.css">
  <script src="/public/jquery-3.4.1.min.js"></script>
  <script src="/public/bootstrap.min.js"></script>
  <style type="text/css">
  .longtext {
      word-wrap: break-word;
      width: 700px;
    }
        body {
    background: #2F4F4F;
    color: #BC8F8F; 
    }
          .headlabel {
      text-align: center;
      font-family: "Times New Roman", Georgia, Serif;
      font-stretch: extra-expanded;
      font-size: 20px;
      color: #008080;
    }
    #processoff {
      text-align: center;
    }
    .nav-menu-rkk {
      margin-right: 100rem;
    }
    .table-block-div
    {
      text-align: center;
    }
    .table-block-div:hover
    {
      background-color: #c0d7d7;
      cursor: pointer;
    }
    .table-block-div-child {
      text-align: center;
    }
    h2
    {
      text-align: center;
    }

  </style>
  <title>RKK Adminkey</title>
 </head>
 <body>

  <div class="headlabel">

<h1>RKK Adminkey</h1>

</div>

<div class="nav-menu-rkk">
 <nav class="navbar navbar-dark bg-dark">
  <a href="http://localhost:3000/monitor/errors" target="_blank"><font size=3px>Топ ошибок</font></a>
</nav>
<nav class="navbar navbar-dark bg-dark">
<a href="http://localhost:3000/monitor/errors/do" target="_blank">Топ ошибок ДО</a>
</nav>
<nav class="navbar navbar-dark bg-dark">
<a href="http://localhost:3000/monitor/cards" target="_blank">Топ проблем с картами</a>
</nav>
<nav class="navbar navbar-dark bg-dark">
<a href="http://localhost:3000/monitor/integration" target="_blank">Топ интеграционных проблем</a>
</nav>
</div>


<p></p>


  <div class="alert alert-danger" role="alert" id=processoff>
  <font size="5">По заявке <%= appnum%> нет действующего процесса!</font>
  </div>
  <p></p>
  <a class="btn btn-primary" href="<%= link %>" role="button" target="_blank">Посмотреть в РКК</a>




<a class="btn btn-primary" href="<%= linkData[0] %>" role="button" target="_blank">Посмотреть журнал статусов в РКК</a>
<a class="btn btn-primary" href="<%= linkData[1] %>" role="button" target="_blank">Сканы документов</a>
<a class="btn btn-primary" href="<%= linkData[2] %>" role="button" target="_blank">Список файлов</a>
<a class="btn btn-primary" href="<%= linkData[3] %>" role="button" target="_blank">Данные ОН</a>
<a class="btn btn-primary" href="<%= linkData[4] %>" role="button" target="_blank">История ОН</a>
<a class="btn btn-primary" href="https://ui.test-stand.tst.int.***.ru/sling/filelist/<%= mapplicationData[0].id %>" role="button" target="_blank">Метаданные файлов</a> 



  <p></p>


  <table class="table table-dark">
   <h2>Основные данные по заявке <%= appnum%></h2>
   <tr>
    <th><font color="#FFDAB9">ID Заявки</font></th>
    <th><font color="#FFDAB9">Направление</font></th>
    <th><font color="#FFDAB9">Канал поступления</font></th>
    <th><font color="#FFDAB9">Канал выдачи</font></th>
    <th><font color="#FFDAB9">Api</font></th>
    <th><font color="#FFDAB9">Код ДО</font></th>
    <th><font color="#FFDAB9">Статус</font></th>
    <th><font color="#FFDAB9">Дата создания заявки</font></th>
    <th><font color="#FFDAB9">Дата перехода в статус</font></th>
    <th><font color="#FFDAB9">Assignee</font></th>
    <th><font color="#FFDAB9">Метод</font></th>
   </tr>
   <tr>
 <td><%= mapplicationData[0].id %></td>
 <td><font color="#AFEEEE"><%= searchData[0].credit_type_name %></font></td>
 <td><%= searchData[0].sale_channel_name %></td>
 <% if (!searchData[0].issue_channel) { %> 
 <td>NULL</td>
<% } else { %>
<td><%= searchData[0].issue_channel %></td>
<% } %>
  <% if (searchData[0].api == true) { %> 
<td><font color="green"><%= searchData[0].api %></font></td>
 <% }  if (searchData[0].api == false) { %>
 <td><font color="red"><%= searchData[0].api %></font></td>
 <% }  if (!searchData[0].api) { %>
  <td><%= searchData[0].api%></td>
   <% }; %>
 <td><%= searchData[0].branch_unit_name%></td>
 <td><font color="#D2691E"><%= searchData[0].appstatus_name %></font></td>

 <td><%= searchData[0].creation_date%></td>
 <th><%= searchData[0].date_status %></th>
 <th><%= searchData[0].assignee %></th>
 <td><%= searchData[0].method %></td>
  </tr>
  </table>


<div class="table-block-div"><a onclick="hideElement('divTableContainer#1')" style="display: block"><font size="6">&darr; Дополнительные данные по заявке</font></a></div>


<div class="div-tables-container" id="divTableContainer#1" style="display: block">

  <div class="table-block-div-child"><a style="display: block"><font size="6">&darr; Данные заявки</font></a></div>

  <table class="table table-striped table-dark" id = "mapplicationData" style="display: block">
  
   <tr>
    <th scope="col" class="colp"><font color="#FFDAB9">Субкатегория по заявке</font></th>
    <th scope="col" class="colp"><font color="#FFDAB9">Фактический статус</font></th>
    <th scope="col" class="colp"><font color="#FFDAB9">ID заявки в Икар</font></th>
    <th scope="col" class="colp"><font color="#FFDAB9">Сотрудник, заводивший заявку</font></th>
    <th scope="col" class="colp"><font color="#FFDAB9">Порядок выдачи кредита</font></th>
    <th scope="col" class="colp"><font color="#FFDAB9">Форма закладной (mortgage_form)</font></th>
    <th scope="col" class="colp"><font color="#FFDAB9">Метод регистрации ДКП</font></th>
    <th scope="col" class="colp"><font color="#FFDAB9">Дата запроса в БКИ</font></th>
   </tr>
<tr>
   <% mapplicationData.forEach(function(el) { %>
 
 <tr>
 <td><%= el.app_sub_category_id %></td>
 <td><font color="#AFEEEE"><%= el.app_status_id %></font></td>
 <td><%= el.app_ikar_number %></td>
 <th><%= el.employee_login %></th>
 <td><%= el.loan_granting_procedire_id %></td>
 <td><%= el.mortgage_form_id %></td>
 <td><%= el.registration_method_dkp_id %></td>
 <td><%= el.date_bki %></td>
  </tr>
 <% }); %>
</table>


</div>


 <p></p>
   <table class="table table-dark" id = "#t3">
  <h2>Параметры заявки</h2>
   <tr>
    <th><font color="#FFDAB9">Тип параметров</font></th>
    <th><font color="#FFDAB9">Версия и код субпрограммы</font></th>
    <th><font color="#FFDAB9">Сумма кредита</font></th>
    <th><font color="#FFDAB9">Ежемесячный платеж</font></th>
    <th><font color="#FFDAB9">Срок кредита</font></th>
    <th><font color="#FFDAB9">Регион ОН</font></th>
    <th><font color="#FFDAB9">Стоимость ОН</font></th>
    <th><font color="#FFDAB9">Вид рынка</font></th>
    <th><font color="#FFDAB9">Ставка</font></th>
    <th><font color="#FFDAB9">Тип платежа</font></th>
    <th><font color="#FFDAB9">Тип страхования</font></th>
    <th><font color="#FFDAB9">Дата подписания</font></th>
    <th><font color="#FFDAB9">Тип формы</font></th>
    <th><font color="#FFDAB9">Цель</font></th>
    <th><font color="#FFDAB9">№ дов.подписанта</font></th>
    <th><font color="#FFDAB9">Дата дов.подписанта</font></th>
   </tr>
   <% params.forEach(function(el) { %>
   <tr>
  <% if (el.case_partype !== 'Выданные') { %> 
 <td><%= el.case_partype%></td>
 <% }  else { %>
 <td><font color="#D2691E"><%= el.case_partype%></font></td>
 <% }; %>
 <td><%= el.sub_program_version + ' ' + el.sub_program_id %></td>
 <td><%= el.credit_amount%></td>
 <td><%= el.monthly_payment%></td>
 <td><%= el.credit_term%></td>
 <td><%= el.real_estate_region %></td>
 <td><%= el.real_estate_cost%></td>
 <td><%= el.case_market%></td>
 <td><%= el.interest_rate%></td>
 <td><%= el.case_payment%></td>
 <td><%= el.case_ins%></td>
 <td><%= el.date_sign%></td> 
 <td><%= el.signer_fio%></td>
 <td><%= el.case_target%></td>
 <td><%= el.signer_power_of_attorney_num%></td>
 <td><%= el.signer_power_of_attorney_date%></td>
  </tr>
  <% }); %>
   <p></p>
  </table>

<p></p>


<div class="table-block-div"><a onclick="hideElement('ParticipantsData')" style="display: block"><font size="6">&darr; Данные по участникам сделки</font></a></div>

 <p></p>
   
   <table class="table table-dark" id = "ParticipantsData">
  <h2>Участники сделки</h2>
   <tr>

    <th><font color="#FFDAB9">Participant_form_id</font></th>
    <th><font color="#FFDAB9">Participant_id</font></th>
    <th><font color="#FFDAB9">Среднемесячный доход</font></th>
    <th><font color="#FFDAB9">Код субкатегории</font></th>
    <th><font color="#FFDAB9">Признак сотрудника</font></th>
    <th><font color="#FFDAB9">Признак залогодателя</font></th>
    <th><font color="#FFDAB9">Признак доработки (rework)</font></th>
    <th><font color="#FFDAB9">Роль</font></th>
    <th><font color="#FFDAB9">Тип продавца</font></th>
    <th><font color="#FFDAB9">Удален?</font></th>
   </tr>
   <% participant.forEach(function(el) { %>
   <tr>
 <td><%= el.participant_form_id %></td>
 <td><%= el.id %></td>
 <td><%= el.avg_month_income %></td>
 <td><%= el.sub_category_id %></td>
 <td><%= el.employee %></td>
 <td><%= el.mortgagor_flag %></td>
 <td><%= el.rework %></td>
 <td><%= el.case_role %></td>
  <td><%= el.case_seller %></td>
  <% if (el.is_deleted == true) { %> 
 <td><font color="#8A0829"><%= el.is_deleted %></font></td>
 <% }  else { %>
 <td><font color="#008000"><%= el.is_deleted %></font></td>
 <% }; %>
  </tr>
  <% }); %>
  <% }; %>
</table>

<p></p>


<div class="table-block-div"><a onclick="hideElement('AccountsData')" style="display: block"><font size="6">&darr; Счета по заявке</font></a></div>

 <p></p>
   
   <table class="table table-dark" id = "AccountsData">
  <h2>Участники сделки</h2>
   <tr>

    <th><font color="#FFDAB9">Participant_form_id</font></th>
    <th><font color="#FFDAB9">Participant_id</font></th>
    <th><font color="#FFDAB9">Среднемесячный доход</font></th>
    <th><font color="#FFDAB9">Код субкатегории</font></th>
    <th><font color="#FFDAB9">Признак сотрудника</font></th>
    <th><font color="#FFDAB9">Признак залогодателя</font></th>
    <th><font color="#FFDAB9">Признак доработки (rework)</font></th>
    <th><font color="#FFDAB9">Роль</font></th>
    <th><font color="#FFDAB9">Тип продавца</font></th>
    <th><font color="#FFDAB9">Удален?</font></th>
   </tr>
   <% participant.forEach(function(el) { %>
   <tr>
 <td><%= el.participant_form_id %></td>
 <td><%= el.id %></td>
 <td><%= el.avg_month_income %></td>
 <td><%= el.sub_category_id %></td>
 <td><%= el.employee %></td>
 <td><%= el.mortgagor_flag %></td>
 <td><%= el.rework %></td>
 <td><%= el.case_role %></td>
  <td><%= el.case_seller %></td>
  <% if (el.is_deleted == true) { %> 
 <td><font color="#8A0829"><%= el.is_deleted %></font></td>
 <% }  else { %>
 <td><font color="#008000"><%= el.is_deleted %></font></td>
 <% }; %>
  </tr>
  <% }); %>
  <% }; %>
</table>

<p></p>




<div class="table-block-div"><a id="#bhidej" onclick="hideElement('#tjournal')" style="display: block"><font size="6">&darr; Расширенный журнал статусов по заявке</font></a></div>

  <table class="table table-striped table-dark" id = "#tjournal" style="display: block">
  
   <tr>
    <th scope="col" class="colp"><font color="#FFDAB9">Дата, время перехода в статус</font></th>
    <th scope="col" class="colp"><font color="#FFDAB9">Имя статуса</font></th>
    <th scope="col" class="colp"><font color="#FFDAB9">Решение СПР</font></th>
    <th scope="col" class="colp"><font color="#FFDAB9">ФИО и логин сотрудника</font></th>
    <th scope="col" class="colp"><font color="#FFDAB9">Роль сотрудника</font></th>
    <th scope="col" class="colp"><font color="#FFDAB9">Этап и статус андеррайтинга</font></th>
    <th scope="col" class="colp"><font color="#FFDAB9">Дата, время закрытия статуса</font></th>
   </tr>
<tr>
   <% stat.forEach(function(el, i, arr) { %>
 
 <tr>
 <td><%= stat[i].start_date %></td>
 <td><font color="#AFEEEE"><%= stat[i].status_name %></font></td>
 <td><%= stat[i].rtdm_decision_name %></td>
 <th><%= stat[i].u_fio +" "+ stat[i].u_login %></th>
 <td><%= stat[i].u_role %></td>
 <td><%= stat[i].und_stage +" "+ stat[i].und_status_name %></td>
 <td><%= stat[i].end_date %></td> 
  </tr>
 <% }); %>
</table>


<p></p>

<div class="table-block-div"><a id="#bhidev" onclick="hideElement('#tevents')" style="display: block"><font size="6">&darr; Журнал событий по заявке</font></a></div>


  <table class="table table-striped table-dark" id = "#tevents" style="display: none">
  
   <tr>
    <th scope="col" class="colp"><font color="#FFDAB9">Дата, время события</font></th>
    <th scope="col" class="colp"><font color="#FFDAB9">Имя события</font></th>
    <th scope="col" class="colp"><font color="#FFDAB9">Логин сотрудника, связанного с событием</font></th>
   </tr>
<tr>
   <% event.forEach(function(el, i, arr) { %>
 
 <tr>
 <td><%= event[i].event_time %></td>
 <td><font color="#AFEEEE"><%= event[i].event_description %></font></td>
 <td><%= event[i].value %></td>
  </tr>
 <% }); %>

</table>

 <p></p>


  <div class="table-block-div"><a id="#bshowt2" onclick="hide3('#bshowt2')" style="display: block"><font size="6">&rarr; Интеграционные логи по заявке</font></a></div>
  <button type="submit" onclick="showLongtext(longtext)">Показать/скрыть ВСЕ запросы/ответы</button>

  <table class="table table-striped table-dark" id = "#t2" style="display: none">
  
 <tr>
    <th scope="col" class="colp"><font color="#FFDAB9">interaction ID</font></th>
    <th scope="col" class="colp"><font color="#FFDAB9">Целевая система (Endpoint)</font></th>
    <th scope="col" class="colp"><font color="#FFDAB9">Результат</font></th>
    <th scope="col" class="colp"><font color="#FFDAB9">Текст ошибки</font></th>
    <th scope="col" class="colp"><font color="#FFDAB9">Дата, время интеграции</font></th>
    <th scope="col" class="colp"><font color="#FFDAB9">Запрос/ответ</font></th>
 </tr>

   <% int.forEach(function(el, i) { %>
 
 <tr>
 <td><%= int[i].interaction_id %></td>
 <td><font color="#AFEEEE"><%= int[i].System %></font></td>
 <td><%= int[i].result %></td>
 <td><font color="#FF6347"><%= int[i].error_description %></font></td>
 <td><%= int[i].interaction_ts %></td> 
<td >
    <button type="submit" onclick="hide_<%=i%>()">Показать/скрыть запрос/ответ</button>
    <p class="longtext" id="<%=i%>_long" style="display: none">
     <font color="#FF8C00"><%= int[i].body %></font>
    </p>
 </td>
</tr>
 <% }); %>

</table>

<% int.forEach(function(el, i) { %>
<script>

    function hide_<%=i%>() {

      var elem = document.getElementById("<%=i%>_long");
      if (elem.style.display === "none") {


        elem.style.display = "block";
      } else {

        elem.style.display = "none";
      }

    }

</script>
<% }); %>

<script type="text/javascript">




  function hideElement(id) {

    var elem = document.getElementById(id);

    elem.style.display === 'block' ? elem.style.display = 'none' : elem.style.display = 'block';


  }


  function showLongtext(className) {

    var elem = document.getElementsByClassName(className);

    for (let i=0; i < elem.length; i++) {

      elem[i].style.display === 'block' ? elem[i].style.display = 'none' : elem[i].style.display = 'block';

    }

}


</script>



 </body>
</html>


